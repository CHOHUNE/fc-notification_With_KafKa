# Kafka란 무엇인가요?
> data stream을 처리하기 위한 분산 메세징 시스템
> 즉 application간 data를 주고받는 *우체국* 같은 역할이다.

## 카프카의 핵심 개념
1. 메시지 : 카프카가 주고받는 데이터 단위
   2. 로그 메세지, 사용자 클릭 이벤트
3. 토픽 : 메세지를 분류할 수 있는 카테고리 
   4. 주문, 결제, 배송
5. 파티션 : 토픽 내에서 메세지를 분산 저장하는 단위
   6. 하나의 토픽을 여러 파티션으로 나눌 수 있다.
      7. 네이버페이 결제, 카카오 결제, 토스 결제
8. 컨슈머 : 카프카에서 메세지를 가져가는 어플리케이션
   9. 로그를 분석하는 프로그램
10. 브로커 : 카프카 서버. 
    11. 각 브로커는 일부 토픽의 파티션을 담당한다.
11. 클러스터 : 브로커가 모인 것 

## 카프카의 동작 방식
1. 프로듀서가 메세지를 특정 토픽에 전송
2. 카프카 브로커는 이 메세지를 해당 토픽의 파티션에 저장
3. 컨슈머는 관심있는 토픽을 구독, 저장된 메세지를 가져간다.
4. 카프카는 메세지를 일정 기간 보관하므로, 컨슈머가 일시적으로 중단되어도 나중에 메세지를 처리할 수 있다.

## 카프카의 특징
1. 고성능 : 초당 수백만 개의 메세지 처리
2. 확장성 : 브로커를 추가해 쉽게 시스템 확장
3. 내구성 : 메세지를 디스크에 저장해 데이터 손실 방지
4. 분산 처리 : 여러 서버에 분산

### 주키퍼란? Zookeeper
> 분산시스템을 관리하기 위한 코디네이션 서비스. 여러 서버가 함께할 때 필요한 관리자 역할을 한다.
1. 구성 정보 관리 : 시스템 설정 정보를 중앙에서 관리 
2. 네이밍 서비스 : 시스템 내 서버에 이름을 부여하고 관리
3. 분산 동기화 : 여러 서버 간 작업을 조율
4. 그룹 서비스 : 서버 그룹을 관리하고, 그룹 내 변경사항을 알린다

### 카프카에서 주키퍼 역할
1. 브로커 관리 : 카프카 클러스터에 속한 브로커들의 목록을 관리한다. 
2. 토픽 구성 저장 : 토픽의 파티션 수, 복제 팩터 등의 설정 정보를 저장
3. 컨트롤러 선출 : 카프카 클러스터에서 '컨트롤러' 역할을 할 브로커를 선출
4. ACL (접근 제어 목록) 저장 : 보안 설정을 저장

>예를 들어 클라이언트가 `토픽 A의 데이터를 주세요` 라고 요청하면 주키퍼가 `브로커 3번의 파티션2에 있습니다` 라고 안내하는 역할을 한다.

### 카프카와 주키퍼의 관계
>카프카 클러스터는 주키퍼 없이는 제대로 작동할 수 없다. 주키퍼는 카프카카 분산 시스템으로 작동하기 위해 필요한 서비스를 제공한다.

1. 카프카 시작 시 : 카프카 브로커는 시작 시 주키퍼에게 자신의 정보를 등록한다
2. 토픽 생성 시: 새 토픽이 생성되면, 그 정보는 주키퍼에 저장된다.
3. 브로커 장애 시 : 브로커에 문제가 생기면, 주키퍼는 이를 감지하고 다른 브로커에게 알린다.
4. 컨슈머 연결시 : 컨슈머가 카프카에 연결하면, 주키퍼를 통해 어떤 브로커와 통신해야 하는지 정보를 얻는다.



